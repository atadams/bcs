function startAnimation(){renderNarration(),renderUnaffected()}function advanceAnimation(){switch(1==animationStep&&$("#animation-advance-button").text("Next"),animationStep){case 1:setNarrationText("Let's follow 1,000 women starting at age 40. Each dot below represent 1 woman. There are 1,000 dots.",0),renderUnaffected();break;case 2:g.transition().duration(1e3).attr("transform","translate(200,"+height/2+") scale(1)"),setNarrationText("If we followed these 1,000 women starting today and continued until their deaths — if they didn’t get screened there would be about 129 breast cancer cases and 25 deaths from breast cancer."),moveCohort("noScreening",2e3),setHarmData("noScreening","deaths,cases",3e3);break;case 3:setNarrationText("If these 1,000 women were screened every other year starting at age 50 and stopped at age 74, there would be about 151 breast cancer cases and 18 deaths from breast cancer."),moveCohort("fifties",2e3),setHarmData("fifties","deaths,cases",3e3);break;case 4:setNarrationText("But there are harms to breast cancer screening. One of these harms is a false alarm. A false alarm is when the breast cancer screening suggests a woman has breast cancer when she does not.");break;case 5:setNarrationText("If these 1,000 women started screening at 50, there would be about 953 false alarms."),setHarmData("fifties","falsealarm",1e3);break;case 6:setNarrationText("False alarms can mean that women may have more testing or procedures that they do not need. For example, women may have more imaging tests (pictures) or biopsies* after a false alarm. These extra tests all show that there is no breast cancer.");break;case 7:setNarrationText("If these 1,000 women started screening at 50, there would be about 145 biopsies that find no cancer."),setHarmData("fifties","biopsies",1e3);break;case 8:setNarrationText("Another harm is overdiagnosis. Overdiagnosis is when breast cancer screening finds breast cancer that would not have caused symptoms or harm to a woman during her lifetime. These cancers grow very slow or not at all. This can lead to treatment like surgery, chemotherapy, and radiation that is not needed and causes harm.");break;case 9:setNarrationText("When a woman is diagnosed with breast cancer, health care professionals do not know if the breast cancer will cause health problems over her lifetime. This means that almost all women who are diagnosed with breast cancer are treated.");break;case 10:setNarrationText("If these 1,000 women started screening at 50, there would be about 19 overdiagnosed breast cancers."),setHarmData("fifties","overdiagnoses",1e3);break;case 11:setNarrationText("Now let’s look at these 1,000 women if they started screening at age 40 instead of 50.");break;case 12:setNarrationText("If these 1,000 women were screened every other year starting at 40 and stopped at age 74, there would be about 154 breast cancer cases and 17 deaths from breast cancer."),hideHarmData(),moveCohort("forties",2e3),setHarmData("forties","deaths,cases",3e3);break;case 13:setNarrationText("But, if these 1,000 women started screening at age 40, there would be about 1,529 false alarms, 213 biopsies, and 21 overdiagnosed breast cancers."),setHarmData("forties","falsealarm,biopsies,overdiagnoses",1e3),d3.selectAll(".screening-visible__end").transition().duration(1e3).style("opacity",1).delay(1e3)}animationStep++}function setNarrationText(e,t){void 0===t&&(t=500),d3Narration.transition().duration(500).style("opacity",0).transition().style("opacity",1).text(e).transition().delay(t)}function renderUnaffected(){g.selectAll("circle").data(nodes).enter().append("circle").style("fill",function(e){return cohortGroups.unaffected.color}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",4).attr("id",function(e){return e.id}).style("opacity",0).transition().duration(50).delay(function(e,t){return t/2}).style("opacity",1),g.attr("transform","translate("+width/2+","+height/2+")")}function initHarms(){harmG.append("text").attr("class","screening-chart__header").attr("y",20).attr("x",730).attr("text-anchor","middle").text("No"),harmG.append("text").attr("class","screening-chart__header").attr("y",35).attr("x",730).attr("text-anchor","middle").text("Screening"),harmG.append("text").attr("class","screening-chart__label").attr("y",35+harmLineheight).attr("x",675).attr("text-anchor","end").text(harmInfo.labels.deaths+":")}function renderHarms(){var e=0;for(harm in harmInfo.labels)harmG.append("text").attr("class","screening-chart__label").attr("y",35+harmLineheight+harmLineheight*e).attr("x",675).attr("text-anchor","end").text(harmInfo.labels[harm]+":"),harmG.append("text").attr("class","screening-chart__label--fifties").attr("y",35+harmLineheight+harmLineheight*e).attr("x",750).attr("text-anchor","end").text(d3.format(",")(cohortGroups.fifties.harms[harm])),harmG.append("text").attr("class","screening-chart__label--fifties").attr("y",35+harmLineheight+harmLineheight*e).attr("x",850).attr("text-anchor","end").text(d3.format(",")(cohortGroups.forties.harms[harm])),e++}function initCohorts(e,t,a){void 0===t&&(t=0),void 0===a&&(a=0);var r=Math.PI*(3-Math.sqrt(5));return function(o){var n=1.5+e*Math.sqrt(o),s=r*o,i=t+n*Math.cos(s),c=a+n*Math.sin(s);return{x:i,y:c,origX:i,origY:c,cohort:"unaffected",id:"id"+o}}}function initStatus(e){for(var t=0;t<25;t++){var a=e.filter(findUnaffected),r=Math.floor(Math.random()*a.length);a[r].cohort="noscreening",a[r].positions={unaffected:{x:a[r].x,y:a[r].y},fifties:{x:a[r].x,y:a[r].y},forties:{x:a[r].x,y:a[r].y}},a[r].color={unaffected:cohortGroups.survivor.color,affected:cohortGroups.affected.color,noScreening:cohortGroups.affected.color,fifties:cohortGroups.survivor.color,forties:cohortGroups.survivor.color},a[r].positions.noScreening=cohortPositions[t]}for(var t=0;t<17;t++){var o=e.filter(findNoScreening),n=Math.floor(Math.random()*o.length);o[n].cohort="forties",o[n].positions.forties=o[n].positions.noScreening,o[n].positions.fifties=o[n].positions.noScreening,o[n].color.forties=cohortGroups.affected.color,o[n].color.fifties=cohortGroups.affected.color}o=e.filter(findNoScreening),n=Math.floor(Math.random()*o.length),o[n].cohort="fifties",o[n].positions.fifties=o[n].positions.noScreening,o[n].color.fifties=cohortGroups.affected.color}function initDataLayout(){var e=0,t=40,a=55;dataG.append("text").attr("id","data--cohort-label").attr("class","screening-chart__cohort-label").attr("x",525).attr("y",30+e*t).attr("text-anchor","middle").text("").style("opacity",0);for(harm in harmInfo.labels)dataG.append("text").attr("id","data--"+harm+"-label").attr("class","screening-chart__data-label").attr("x",525).attr("y",a+e*t).attr("text-anchor","middle").text(harmInfo.labels[harm]+": ").style("opacity",0),a=150,e++}function setDataText(e,t,a){void 0===a&&(a=500),dataG.select("text#"+e).transition().duration(500).style("opacity",0).transition().delay(a).style("opacity",1).text(t).transition().duration(500)}function setHarmData(e,t,a){void 0===a&&(a=500);var e=e.toLowerCase();d3.select("text#data--cohort-label").text()!=cohortGroups[e].label&&setDataText("data--cohort-label",cohortGroups[e].label,a);for(var r=t.split(","),o=0;o<r.length;o++){var n=r[o],s=cohortGroups[e].harms[n];if(s>0){var i="data--"+n+"-label",c=harmInfo.labels[n]+": "+d3.format(",")(cohortGroups[e].harms[n]);setDataText(i,c,a+1500*o)}}}function hideHarmData(){for(harm in harmInfo.labels)dataG.select("text#data--"+harm+"-label").transition().duration(100).style("opacity",0)}function moveCohort(e,t){void 0===t&&(t=0);var a=findCohort("noScreening");a.forEach(function(a){d3.selectAll("circle#"+a.id).transition().duration(2e3).delay(t).ease(d3.easePolyInOut).style("fill",function(t){return t.color[e]}).attr("cx",a.positions[e].x).attr("cy",a.positions[e].y)})}function findUnaffected(e){return"unaffected"===e.cohort}function findNoScreening(e){return"noscreening"===e.cohort}function findForties(e){return"forties"===e.cohort}function findFifties(e){return"fifties"===e.cohort}function findCohort(e){return"forties"==e?nodes.filter(findForties):"fifties"==e?nodes.filter(findForties).concat(nodes.filter(findFifties)):"noScreening"==e?nodes.filter(findForties).concat(nodes.filter(findFifties)).concat(nodes.filter(findNoScreening)):void 0}Checkbix.init(),$(document).ready(function(){$("#for-me-yes").hide(),$("#for-me-no").hide(),$("#for-me input[name*=risk-q]").change(function(){var e={yes:0,no:0};$("#for-me input[name*=risk-q]:checked").each(function(){e[this.value]++}),e.yes>0?$("#for-me-yes").slideUp(200,function(){$("#for-me-no").slideDown(400)}):1==$("#for-me-no").is(":visible")&&$("#for-me-no").slideUp(400),e.yes+e.no==7&&(e.yes>0?$("#for-me-yes").slideUp(200,function(){$("#for-me-no").slideDown(400)}):$("#for-me-no").slideUp(200,function(){$("#for-me-yes").slideDown(400)}))})});var svg=d3.select("#screening-chart--deaths"),width=610,height=420;cohortWidth=386,d3Narration=d3.select("#screening-chart__narration"),d3HarmsTable=d3.select("#screening-chart__table");var harmInfo={labels:{deaths:"Deaths",cases:"Cases",falsealarm:"False Alarms",biopsies:"Biopsies",overdiagnoses:"Overdiagnosed"}},cohortGroups={unaffected:{color:"hsl(0, 0%, 60%)"},affected:{color:"hsl(210, 50%, 47%)"},noscreening:{label:"No Screening",color:"hsl(200, 23%, 46%)",harms:{biopsies:0,cases:129,deaths:25,falsealarm:0,overdiagnoses:0}},forties:{label:"Screening at 40",color:"#eb494f",harms:{biopsies:213,cases:154,deaths:17,falsealarm:1529,overdiagnoses:21}},fifties:{label:"Screening at 50",color:"#76ff03",harms:{biopsies:145,cases:151,deaths:18,falsealarm:953,overdiagnoses:19}},survivor:{color:"hsl(340, 52%, 52%)"}},cohortState="unaffected",cohortPositions=d3.range(25).map(initCohorts(6,325,-100)),nodes=d3.range(1e3).map(initCohorts(6));initStatus(nodes);var g=svg.append("g").attr("id","group-cohorts").attr("transform","translate("+width/3+",0)"),narrationG=svg.append("g").attr("id","group-narration").attr("transform","translate("+width/2+",0)"),harmG=svg.append("g").attr("id","group-harms"),dataG=svg.append("g"),deathsLabelG=svg.append("g").attr("id","group-deaths-label"),cohortsLabelG=svg.append("g").attr("id","group-cohorts-label"),animationStep=1;initDataLayout();